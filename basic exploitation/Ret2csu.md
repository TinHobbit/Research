# Ret2csu
## Introduction
kỹ thuật ret2csu này liên quan đến việc tận dụng 1 gadgets luôn có sẵn trong các file binary là `__libc_csu_init` để bù vào những chỗ  trống cho các gadgets thường dùng trong ROP không có trong file binary. Ví dụ, nếu ta cần thực hiện `execve` syscall, chúng ta cần truyền vào các thanh ghi với các giá trị sau:
-   rdi = địa chỉ trỏ vào chuỗi `/bin/sh`
-   rdx = 0
-   rsi = 0

trong lúc này chúng ta đang tìm các gadget có trong binary, ta sẽ không thể tìm thấy 1 gadget như `pop rdx;ret`. Vì vậy, ret2csu được sinh ra nhờ tận dụng các gadget có trong `_libc_csu_init`, để craft thành 1 payload hoàn chỉnh.
## __libc_csu_init and __libc_csu_fini - Program level ctor/dtor handlers
Mục đích của `__libc_csu_init` là dùng để initialize function và variables để binary có thể dùng. từ source của glibc:
```c
int __libc_csu_init(int argc, char **argv, char **envp)
{
    /*
     * Call all the __attribute__((constructor)) functions.
     * These symbols are generated by the linker.
     */
    size_t num_init = __init_array_end - __init_array_start;
    for (size_t i = 0; i < num_init; i++) {
        __init_array_start[i](argc, argv, envp);
    }
}
```
Tóm lại, thì hàm này dùng để tính toán sự khác biệt giữa `__init_aray` lúc bắt đầu và kết thúc - cái mà bao gồm functions, constructors, destructors, objects... 

Nói đơn giản thì constructor sẽ thực hiện trước hàm `main()` và deconstructor sẽ thực hiện khi kết thúc hàm. Đọc giả có thể đọc sâu hơn về các hàm này ở references bên dưới.
## references 
> http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html

> https://phoxis.org/2011/04/27/c-language-constructors-and-destructors-with-gcc/

> https://oneraynyday.github.io/dev/2020/05/03/Analyzing-The-Simplest-C++-Program/

> http://bottomupcs.sourceforge.net/csbu/x3564.htm

## Practice

